# @gmod/cram

[![Generated with nod](https://img.shields.io/badge/generator-nod-2196F3.svg?style=flat-square)](https://github.com/diegohaz/nod)
[![NPM version](https://img.shields.io/npm/v/@gmod/cram.svg?style=flat-square)](https://npmjs.org/package/@gmod/cram)
[![Build Status](https://img.shields.io/travis/GMOD/cram-js/master.svg?style=flat-square)](https://travis-ci.org/GMOD/cram-js) [![Coverage Status](https://img.shields.io/codecov/c/github/GMOD/cram-js/master.svg?style=flat-square)](https://codecov.io/gh/GMOD/cram-js/branch/master)

Read CRAM files (indexed or unindexed) in node or in the browser.

-   Supports CRAM 3.x and 2.x
-   Does not support CRAM 1.x
-   Will eventually be published on npm as @gmod/cram

## Install

    $ npm install --save @gmod/cram

## Usage

```js
const { IndexedCramFile, CramFile, CraiIndex } = require('@gmod/cram')

// open remote URLs
const bareFile = new CramFile({ url: 'http://example.com/my.cram'})
const indexedFile = new IndexedCramFile({
  cramUrl: 'http://example.com/my.cram',
  index: new CraiIndex({ url: 'http://example.com/my.cram.crai' }),
  // if reference sequences are not embedded, must also provide a
  // `seqFetch` function that returns a promise for a string of residues
  seqFetch: async (seqId, start, end) => {
    return 'ACCTAGCTAGCTAGTAGTACGTAGTCGAGTCGATACTGT'
  }
})

// or with local files
const bareFile = new CramFile({ path: '/path/to/my.cram' })
const indexedFile = new IndexedCramFile({
  cramPath: '/path/to/my.cram',
  index: new CraiIndex({ path: '/path/to/my.cram.crai' })
})

// fetch features from an indexed CRAM file.
// NOTE: only numeric IDs for the reference sequence are accepted
const features = await indexedFile.getFeaturesForRange(0, 10000, 20000)
```

## API (auto-generated)

### CramRecord

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [CramRecord](#cramrecord)
    -   [isPaired](#ispaired)
    -   [isProperlyPaired](#isproperlypaired)
    -   [isSegmentUnmapped](#issegmentunmapped)
    -   [isMateUnmapped](#ismateunmapped)
    -   [isReverseComplemented](#isreversecomplemented)
    -   [isMateReverseComplemented](#ismatereversecomplemented)
    -   [isRead1](#isread1)
    -   [isRead2](#isread2)
    -   [isSecondary](#issecondary)
    -   [isFailedQc](#isfailedqc)
    -   [isDuplicate](#isduplicate)
    -   [isSupplementary](#issupplementary)
    -   [isDetached](#isdetached)
    -   [hasMateDownStream](#hasmatedownstream)
    -   [isPreservingQualityScores](#ispreservingqualityscores)
    -   [isUnknownBases](#isunknownbases)
    -   [addReferenceSequence](#addreferencesequence)

#### CramRecord

Class of each CRAM record returned by this API.

##### isPaired

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read is paired, regardless of whether both segments are mapped

##### isProperlyPaired

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read is paired, and both segments are mapped

##### isSegmentUnmapped

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read itself is unmapped; conflictive with isProperlyPaired

##### isMateUnmapped

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read itself is unmapped; conflictive with isProperlyPaired

##### isReverseComplemented

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read is mapped to the reverse strand

##### isMateReverseComplemented

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the mate is mapped to the reverse strand

##### isRead1

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if

##### isRead2

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if

##### isSecondary

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if

##### isFailedQc

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if

##### isDuplicate

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read is an optical or PCR duplicate

##### isSupplementary

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if

##### isDetached

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read is detached

##### hasMateDownStream

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read has a mate in this same CRAM segment

##### isPreservingQualityScores

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read contains qual scores

##### isUnknownBases

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if the read has no sequence bases

##### addReferenceSequence

annotates this feature with the given reference region.
right now, this only uses the reference sequence to decode
which bases are being substituted in base substitution features.

**Parameters**

-   `refRegion` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `refRegion.start` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
    -   `refRegion.end` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
    -   `refRegion.seq` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `compressionScheme` **CramContainerCompressionScheme** 

Returns **any** nothing

### IndexedCramFile

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [getFeaturesForRange](#getfeaturesforrange)
-   [hasDataForReferenceSequence](#hasdataforreferencesequence)

#### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.cram` **CramFile** 
    -   `args.index` **Index-like** object that supports getEntriesForRange(seqId,start,end) -> Promise\[Array[index entries]]
    -   `args.cacheSize` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** optional maximum number of CRAM records to cache.  default 20,000
    -   `args.fetchSizeLimit` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** optional maximum number of bytes to fetch in a single getFeaturesForRange call.  Default 3 MiB.
    -   `args.checkSequenceMD5` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** default true. if false, disables verifying the MD5
        checksum of the reference sequence underlying a slice. In some applications, this check can cause an inconvenient amount (many megabases) of sequences to be fetched.

#### getFeaturesForRange

**Parameters**

-   `seq` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** numeric ID of the reference sequence
-   `start` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** start of the range of interest. 1-based closed coordinates.
-   `end` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** end of the range of interest. 1-based closed coordinates.

#### hasDataForReferenceSequence

**Parameters**

-   `seqId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** true if the CRAM file contains data for the given
reference sequence numerical ID

### CramFile

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [containerCount](#containercount)

#### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.filehandle` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** a filehandle that implements the stat() and
        read() methods of the Node filehandle API <https://nodejs.org/api/fs.html#fs_class_filehandle>
    -   `args.path` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** path to the cram file
    -   `args.url` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** url for the cram file.  also supports file:// urls for local files
    -   `args.seqFetch` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** a function with signature
        `(seqId, startCoordinate, endCoordinate)` that returns a promise for a string of sequence bases
    -   `args.cacheSize` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** optional maximum number of CRAM records to cache.  default 20,000
    -   `args.checkSequenceMD5` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** default true. if false, disables verifying the MD5
        checksum of the reference sequence underlying a slice. In some applications, this check can cause an inconvenient amount (many megabases) of sequences to be fetched.

#### containerCount

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the number of containers in the file

### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.filehandle` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a filehandle that implements the stat() and
        read() methods of the Node filehandle API <https://nodejs.org/api/fs.html#fs_class_filehandle>
    -   `args.seqFetch` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a function with signature
        `(seqId, startCoordinate, endCoordinate)` that returns a promise for a string of sequence bases

### containerCount

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the number of containers in the file

### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

### CramMalformedError

**Extends CramError**

An error caused by malformed data.

### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

### CraiIndex

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [hasDataForReferenceSequence](#hasdataforreferencesequence)
-   [getEntriesForRange](#getentriesforrange)

#### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
    -   `args.url` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
    -   `args.filehandle` **FileHandle?** 

#### hasDataForReferenceSequence

**Parameters**

-   `seqId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

#### getEntriesForRange

fetch index entries for the given range

**Parameters**

-   `seqId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `queryStart` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `queryEnd` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### Exception Classes

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [CramUnimplementedError](#cramunimplementederror)
-   [CramMalformedError](#crammalformederror)
-   [CramBufferOverrunError](#crambufferoverrunerror)
-   [CramSizeLimitError](#cramsizelimiterror)
-   [CramArgumentError](#cramargumenterror)

#### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

#### CramMalformedError

**Extends CramError**

An error caused by malformed data.

#### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

#### CramSizeLimitError

**Extends CramError**

An error caused by data being too big, exceeding a size limit.

#### CramArgumentError

**Extends CramError**

An invalid argument was supplied to a cram-js method or object.

### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

### CramMalformedError

**Extends CramError**

An error caused by malformed data.

### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

## License

MIT © [Robert Buels](https://github.com/rbuels)
