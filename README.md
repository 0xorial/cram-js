# @gmod/cram

[![Generated with nod](https://img.shields.io/badge/generator-nod-2196F3.svg?style=flat-square)](https://github.com/diegohaz/nod)
[![NPM version](https://img.shields.io/npm/v/@gmod/cram.svg?style=flat-square)](https://npmjs.org/package/@gmod/cram)
[![Build Status](https://img.shields.io/travis/GMOD/cram-js/master.svg?style=flat-square)](https://travis-ci.org/GMOD/cram-js) [![Coverage Status](https://img.shields.io/codecov/c/github/GMOD/cram-js/master.svg?style=flat-square)](https://codecov.io/gh/GMOD/cram-js/branch/master)

Read CRAM files (indexed or unindexed) in node or in the browser.

-   Supports CRAM 3.x and 2.x
-   Does not support CRAM 1.x
-   Will eventually be published on npm as @gmod/cram

## Install

    $ npm install --save @gmod/cram

## Usage

```js
const { IndexedCramFile, CramFile, CraiIndex } = require('@gmod/cram')

// open remote URLs
const bareFile = new CramFile({ url: 'http://example.com/my.cram'})
const indexedFile = new IndexedCramFile({
  cramUrl: 'http://example.com/my.cram',
  index: new CraiIndex({ url: 'http://example.com/my.cram.crai' }),
  // if reference sequences are not embedded, must also provide a
  // `seqFetch` function that returns a promise for a string of residues
  seqFetch: async (seqId, start, end) => {
    return 'ACCTAGCTAGCTAGTAGTACGTAGTCGAGTCGATACTGT'
  }
})

// or with local files
const bareFile = new CramFile({ path: '/path/to/my.cram' })
const indexedFile = new IndexedCramFile({
  cramPath: '/path/to/my.cram',
  index: new CraiIndex({ path: '/path/to/my.cram.crai' })
})

// fetch features from an indexed CRAM file.
// NOTE: only numeric IDs for the reference sequence are accepted
const features = await indexedFile.getFeaturesForRange(0, 10000, 20000)
```

## API (auto-generated)

### IndexedCramFile

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [getFeaturesForRange](#getfeaturesforrange)

#### constructor

**Parameters**

-   `args` **any** 

#### getFeaturesForRange

**Parameters**

-   `seq` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number))** string or numeric ID of the reference sequence
-   `start` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `end` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### CramFile

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [containerCount](#containercount)

#### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.filehandle` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** a filehandle that implements the stat() and
        read() methods of the Node filehandle API <https://nodejs.org/api/fs.html#fs_class_filehandle>
    -   `args.path` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** path to the cram file
    -   `args.url` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** url for the cram file.  also supports file:// urls for local files
    -   `args.seqFetch` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** a function with signature
        `(seqId, startCoordinate, endCoordinate)` that returns a promise for a string of sequence bases

#### containerCount

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the number of containers in the file

### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.filehandle` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a filehandle that implements the stat() and
        read() methods of the Node filehandle API <https://nodejs.org/api/fs.html#fs_class_filehandle>
    -   `args.seqFetch` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** a function with signature
        `(seqId, startCoordinate, endCoordinate)` that returns a promise for a string of sequence bases

### containerCount

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the number of containers in the file

### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

### CramMalformedError

**Extends CramError**

An error caused by malformed data.

### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

### CraiIndex

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [constructor](#constructor)
-   [getEntriesForRange](#getentriesforrange)

#### constructor

**Parameters**

-   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `args.path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
    -   `args.url` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
    -   `args.filehandle` **FileHandle?** 

#### getEntriesForRange

fetch index entries for the given range

**Parameters**

-   `seqId` **any** 
-   `queryStart` **any** 
-   `queryEnd` **any** 

### Exception Classes

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [CramUnimplementedError](#cramunimplementederror)
-   [CramMalformedError](#crammalformederror)
-   [CramBufferOverrunError](#crambufferoverrunerror)

#### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

#### CramMalformedError

**Extends CramError**

An error caused by malformed data.

#### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

### CramUnimplementedError

**Extends Error**

Error caused by encountering a part of the CRAM spec that has not yet been implemented

### CramMalformedError

**Extends CramError**

An error caused by malformed data.

### CramBufferOverrunError

**Extends CramMalformedError**

An error caused by attempting to read beyond the end of the defined data.

## License

MIT Â© [Robert Buels](https://github.com/rbuels)
